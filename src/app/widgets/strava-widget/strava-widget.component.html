<app-widget [widgetData]="{}" (refreshWidgetAction)="this.refreshWidget()" [isWidgetLoaded]="this.isWidgetLoaded">
  <ng-template #header>
    <div *ngIf="athlete" id="stravaWidgetHeader" class="h-10">
      <a [href]="getAthleteProfileUrl(athlete.id)" class="flex flex-row items-center space-x-2">
        <img class="w-9 rounded" [src]="athlete.profileMedium" alt="athlete profile" />
        <p>{{ athlete.firstname }} {{ athlete.lastname }}</p>
      </a>
    </div>
    <div *ngIf="!athlete">Strava</div>
  </ng-template>

  <ng-template #body>
    <ng-template [ngIf]="this.isUserLoggedIn()" [ngIfElse]="isUserNotConnected">
      <div class="max-h-48 overflow-y-scroll">
        <div *ngFor="let activity of this.activities.slice().reverse(); let index = index" class="stravaActivity">
          <mat-expansion-panel hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title> {{ getTitleToDisplay(activity) }} </mat-panel-title>
            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>
              <div>
                <div>
                  <a href="https://www.strava.com/activities/{{ activity.id }}">
                    {{ formatDate(activity.startDateLocal) }}{{ activity.name }}
                  </a>
                </div>
                <div>Distance : {{ roundDistance(activity.distance) / 1000 }} kms</div>
                <div>Durée : {{ convertDecimalTimeToTime(activity.movingTime / 60) }} mins</div>
                <div>Denivelé : {{ activity.totalElevationGain }} mètres</div>
                <div>Trophées : {{ activity.achievementCount }}</div>
                <div>Vitesse moyenne : {{ activity.averageSpeed }}</div>
                <div>Vitesse max : {{ activity.maxSpeed }}</div>
                <div>Kudos : {{ activity.kudosCount }}</div>
                <div>Commentaires : {{ activity.commentCount }}</div>
              </div>
            </ng-template>
          </mat-expansion-panel>
        </div>
      </div>

      <div class="min-h-24 max-h-96">
        <canvas baseChart [data]="this.activitiesChartData" [type]="'bar'"></canvas>
      </div>
    </ng-template>

    <ng-template #isUserNotConnected>
      <div class="my-auto text-center">
        <button (click)="loginToStrava()" mat-raised-button color="primary">Se connecter</button>
      </div>
    </ng-template>
  </ng-template>
</app-widget>